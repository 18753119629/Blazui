@using  Blazui.Component.EventArgs
@{
    switch (Status)
    {
        case Status.UnChecked:
            _isChecked = string.Empty;
            _isIndeterminate = string.Empty;
            break;
        case Status.Checked:
            _isChecked = "is-checked";
            _isIndeterminate = string.Empty;
            break;
        case Status.Indeterminate:
            _isChecked = string.Empty;
            _isIndeterminate = "is-indeterminate";
            break;
    }
    <label role="checkbox" aria-checked="true" class="el-checkbox @_isChecked @isDisabled">
        <span aria-checked="mixed" class="el-checkbox__input @_isChecked @isDisabled @_isIndeterminate">
            <span class="el-checkbox__inner"></span>
            <input type="checkbox" aria-hidden="true" onchange="@ChangeStatus" class="el-checkbox__original @isDisabled" value="" />
        </span>
        <span class="el-checkbox__label">
            @ChildContent
        </span>
    </label>
}

@functions{
    protected string _isChecked = string.Empty;
    protected string _isIndeterminate = string.Empty;
    protected string isDisabled;

    [Parameter]
    public Status Status { get; set; }

    [Parameter]
    public object TrueValue { get; set; }

    [Parameter]
    public object FalseValue { get; set; }

    [Parameter]
    private EventCallback<UIChangeEventArgs> OnStatusChanged { get; set; }

    protected void ChangeStatus(UIChangeEventArgs uIMouseEvent)
    {
        if (IsDisabled)
        {
            return;
        }
        var oldValue = new CheckBoxValue()
        {
            Status = Status
        };
        var newValue = new CheckBoxValue();
        switch (Status)
        {
            case Status.UnChecked:
                oldValue.Value = FalseValue;
                Status = Status.Checked;
                newValue.Value = TrueValue;
                break;
            case Status.Checked:
                Status = Status.UnChecked;
                oldValue.Value = TrueValue;
                newValue.Value = FalseValue;
                break;
            case Status.Indeterminate:
                Status = Status.Checked;
                oldValue.Value = default;
                newValue.Value = TrueValue;
                break;
        }
        newValue.Status = Status;
        var args = new ChangeEventArgs<CheckBoxValue>();
        args.OldValue = oldValue;
        args.NewValue = newValue;
        OnStatusChanged.InvokeAsync(args).GetAwaiter().GetResult();
    }

    [Parameter]
    private bool IsDisabled
    {
        get
        {
            return isDisabled == "is-disabled";
        }
        set
        {
            if (value)
            {
                isDisabled = "is-disabled";
            }
            else
            {
                isDisabled = null;
            }
        }
    }

    [Parameter]
    protected RenderFragment ChildContent { get; set; }
}
